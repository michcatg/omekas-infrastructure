;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; CONFIGURACIONES PERSONALIZADAS PARA OMEKA S - PRODUCCIÓN
; Este archivo contiene configuraciones optimizadas para entornos de producción
; Prioriza: Seguridad, Rendimiento y Estabilidad
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; SEGURIDAD
; Configuraciones para proteger el servidor y prevenir ataques comunes
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; expose_php
; Oculta la versión de PHP en las cabeceras HTTP (X-Powered-By)
; Valor por defecto: On
; Por qué cambiarlo: Los atacantes pueden usar esta información para explotar
;                    vulnerabilidades conocidas de versiones específicas de PHP
; Impacto: Ninguno en funcionalidad, mejora significativa en seguridad
expose_php = Off

; session.cookie_httponly
; Impide que JavaScript acceda a las cookies de sesión mediante document.cookie
; Valor por defecto: 0 (desactivado)
; Por qué activarlo: Protege contra ataques XSS (Cross-Site Scripting) que intentan
;                    robar cookies de sesión para secuestrar cuentas de usuario
; Impacto: Las cookies solo son accesibles por el servidor HTTP
session.cookie_httponly = 1

; session.cookie_secure
; Requiere que las cookies de sesión SOLO se transmitan por conexiones HTTPS
; Valor por defecto: 0 (desactivado)
; Por qué activarlo: Previene que las cookies se envíen por HTTP sin cifrar,
;                    protegiendo contra ataques man-in-the-middle
; IMPORTANTE: Solo activar si TODO el tráfico es HTTPS (verificar con Traefik)
; Impacto: Las sesiones NO funcionarán si el sitio se accede por HTTP
session.cookie_secure = 1

; session.use_strict_mode
; Rechaza IDs de sesión no inicializados por el servidor (previene ataques de fijación)
; Valor por defecto: 0 (desactivado)
; Por qué activarlo: Un atacante podría forzar un ID de sesión conocido y luego
;                    esperar a que la víctima inicie sesión con ese ID
; Impacto: Mínimo, solo rechaza sesiones sospechosas
session.use_strict_mode = 1

; session.use_only_cookies
; Impide que los IDs de sesión se pasen por URL (?PHPSESSID=xyz)
; Valor por defecto: 1 (ya activado en PHP moderno)
; Por qué mantenerlo: Los IDs en URLs pueden guardarse en historial, logs,
;                     referrers y ser compartidos accidentalmente
; Impacto: Las sesiones SOLO funcionan con cookies habilitadas en el navegador
session.use_only_cookies = 1

; session.cookie_samesite
; Controla cuándo se envían cookies en peticiones cross-site
; Valores posibles: None, Lax, Strict
; - None: Cookie se envía siempre (requiere cookie_secure=1)
; - Lax: Cookie NO se envía en POST cross-site, pero SÍ en navegación normal (recomendado)
; - Strict: Cookie NUNCA se envía en peticiones cross-site
; Por qué Lax: Balance entre seguridad CSRF y usabilidad (enlaces externos funcionan)
; Impacto: Protege contra CSRF manteniendo funcionalidad de enlaces externos
session.cookie_samesite = Lax

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; LÍMITES DE RECURSOS
; Configuraciones para permitir operaciones pesadas típicas de Omeka S
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; post_max_size
; Tamaño máximo de datos que PHP acepta en una petición POST
; Valor por defecto: 8M
; Por qué aumentarlo: Omeka S permite subir imágenes en alta resolución,
;                     videos, PDFs grandes y realizar importaciones masivas
; DEBE ser >= upload_max_filesize (PHP lo requiere)
; Impacto: Permite subir archivos grandes, usa más memoria por petición
post_max_size = 200M

; upload_max_filesize
; Tamaño máximo permitido para UN SOLO archivo subido
; Valor por defecto: 2M
; Por qué aumentarlo: Archivos multimedia modernos (videos 4K, escaneos de alta
;                     resolución) pueden superar fácilmente 100MB
; Impacto: Permite archivos grandes, pero requiere más espacio en disco
upload_max_filesize = 200M

; max_execution_time
; Tiempo máximo (en segundos) que un script PHP puede ejecutarse
; Valor por defecto: 30
; Por qué aumentarlo: Importaciones de colecciones grandes, procesamiento de
;                     imágenes, generación de thumbnails pueden tardar varios minutos
; Impacto: Evita timeouts en operaciones largas, pero scripts colgados tardarán
;          más en terminarse
max_execution_time = 300

; memory_limit
; Memoria máxima que un script PHP puede usar
; Valor por defecto: 128M
; Por qué aumentarlo: Procesamiento de imágenes grandes, manipulación de metadatos
;                     complejos y operaciones batch necesitan más memoria
; Impacto: Permite operaciones complejas, pero aumenta uso de RAM del servidor
memory_limit = 512M

; max_input_time
; Tiempo máximo (en segundos) para recibir datos POST/GET/upload
; Valor por defecto: 60
; Por qué aumentarlo: Subidas de archivos grandes en conexiones lentas pueden
;                     tardar más de 1 minuto en transmitirse
; Impacto: Evita timeouts durante uploads lentos
max_input_time = 300

; max_input_vars
; Número máximo de variables de entrada (GET/POST/COOKIE)
; Valor por defecto: 1000
; Por qué aumentarlo: Formularios complejos en Omeka S (edición de items con
;                     muchos campos de metadatos) pueden superar 1000 variables
; Impacto: Permite formularios más complejos sin perder datos
max_input_vars = 5000

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; MANEJO DE ERRORES - PRODUCCIÓN
; Configuraciones para registrar errores internamente sin exponerlos a usuarios
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; error_reporting
; Nivel de errores que PHP reportará internamente
; Valor por defecto: E_ALL
; E_ALL = Todos los errores y warnings
; ~E_DEPRECATED = Excluir avisos de funciones obsoletas (ruido en logs)
; ~E_STRICT = Excluir sugerencias de código (no son errores reales)
; Por qué esta combinación: Balance entre información útil y ruido innecesario
; Impacto: Logs más limpios enfocados en problemas reales
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT

; display_errors
; Controla si los errores se muestran en la salida HTML al usuario
; Valor por defecto: Off (en producción)
; Por qué desactivarlo: Los mensajes de error exponen rutas de archivos,
;                       estructuras de base de datos y lógica interna que
;                       pueden ayudar a atacantes
; CRÍTICO: NUNCA activar en producción
; Impacto: Usuarios ven página genérica de error en lugar de detalles técnicos
display_errors = Off

; display_startup_errors
; Similar a display_errors pero para errores durante el inicio de PHP
; Valor por defecto: Off
; Por qué desactivarlo: Mismas razones de seguridad que display_errors
; Impacto: Errores de configuración no se muestran a usuarios
display_startup_errors = Off

; log_errors
; Habilita el registro de errores en archivo de log
; Valor por defecto: On
; Por qué mantenerlo: Esencial para debugging y monitoreo en producción
; Impacto: Los errores se guardan en archivo para revisión posterior
log_errors = On

; error_log
; Ruta donde se guardan los logs de errores
; Valor por defecto: depende del sistema
; Por qué especificarlo: Facilita encontrar y analizar errores
; IMPORTANTE: Asegurar que el directorio existe y PHP tiene permisos de escritura
; Impacto: Centraliza logs para análisis
error_log = /var/log/php_errors.log

; ignore_repeated_errors
; Evita registrar el mismo error múltiples veces consecutivas
; Valor por defecto: Off
; Por qué activarlo: Un error en un loop puede llenar logs con miles de líneas
; Impacto: Logs más limpios, más fáciles de analizar
ignore_repeated_errors = On

; ignore_repeated_source
; Ignora la fuente del error al determinar si es repetido
; Valor por defecto: Off
; Por qué activarlo: Complementa ignore_repeated_errors
; Impacto: Reduce aún más la repetición de errores similares
ignore_repeated_source = On

; report_memleaks
; Reporta fugas de memoria detectadas por el administrador de memoria de Zend
; Valor por defecto: On
; Por qué mantenerlo: Ayuda a identificar extensiones o código mal escrito
; Impacto: Información útil para debugging sin overhead significativo
report_memleaks = On

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; ZEND ENGINE - OPTIMIZACIÓN DE RENDIMIENTO
; Configuraciones del motor interno de PHP para máximo rendimiento
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; zend.exception_ignore_args
; No captura argumentos de funciones en stack traces de excepciones
; Valor por defecto: Off
; Por qué activarlo: Los argumentos pueden contener datos sensibles (contraseñas)
;                    y consumen memoria extra en stack traces
; Impacto: Stack traces más seguros y ligeros, pero menos información de debugging
zend.exception_ignore_args = On

; zend.exception_string_param_max_len
; Longitud máxima de parámetros string en excepciones (0 = no incluir)
; Valor por defecto: 15
; Por qué 0: Previene exposición de datos sensibles en strings largos
; Impacto: Mayor seguridad, pero debugging más difícil
zend.exception_string_param_max_len = 0

; zend.assertions
; Controla el comportamiento de la función assert()
; Valores: 1 = generar y ejecutar código, 0 = generar pero no ejecutar, -1 = no generar
; Valor por defecto: 1
; Por qué -1: Las assertions son para desarrollo, en producción son overhead puro
; Impacto: Mejora rendimiento eliminando código de debugging
zend.assertions = -1

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; SESIONES - OPTIMIZACIÓN Y SEGURIDAD
; Configuraciones para mejorar manejo de sesiones y limpieza
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; session.gc_probability y session.gc_divisor
; Controlan la probabilidad de ejecutar garbage collection de sesiones
; Probabilidad = gc_probability / gc_divisor = 1/1000 = 0.1%
; Valor por defecto: probability=1, divisor=100 (1%)
; Por qué reducirlo: Garbage collection es costoso, no es necesario en cada petición
; Impacto: Ahorra CPU en servidores con mucho tráfico, sesiones expiradas
;          se limpian más lentamente
session.gc_probability = 1
session.gc_divisor = 1000

; session.gc_maxlifetime
; Tiempo (en segundos) después del cual una sesión se considera "basura"
; Valor por defecto: 1440 (24 minutos)
; Por qué aumentarlo: Permite sesiones de usuario más largas (24 horas)
;                     Útil para trabajo de catalogación/investigación prolongado
; Impacto: Usuarios pueden permanecer logueados 24h, pero sesiones usan
;          espacio en disco más tiempo
session.gc_maxlifetime = 86400

; session.sid_length
; Longitud del ID de sesión (en caracteres)
; Valor por defecto: 26 (desde PHP 7.1)
; Rango válido: 22-256
; Por qué 48: IDs más largos son exponencialmente más difíciles de adivinar
; Con sid_bits_per_character=6: 48 chars = 288 bits de entropía (extremadamente seguro)
; Impacto: Mayor seguridad contra ataques de fuerza bruta, IDs ligeramente más grandes
session.sid_length = 48

; session.sid_bits_per_character
; Bits por carácter en el ID de sesión
; Valores posibles: 4 (0-9,a-f), 5 (0-9,a-v), 6 (0-9,a-z,A-Z,-,_)
; Valor por defecto: 5
; Por qué 6: Usa el alfabeto completo (62 caracteres), maximiza entropía
; Impacto: IDs más cortos con la misma seguridad (o más seguros con misma longitud)
session.sid_bits_per_character = 6

; session.save_path
; Directorio donde se almacenan los archivos de sesión
; Valor por defecto: /tmp
; Por qué especificarlo: Mejor organización, evita conflictos con otras apps,
;                        facilita monitoreo de espacio
; IMPORTANTE: El directorio debe existir y tener permisos correctos (0700)
; Impacto: Sesiones organizadas, más fáciles de gestionar
session.save_path = "/var/lib/php/sessions"

; session.name
; Nombre de la cookie de sesión
; Valor por defecto: PHPSESSID
; Por qué cambiarlo: El nombre por defecto identifica que es PHP, útil para atacantes
; Impacto: Ligeramente más seguro por obscuridad
session.name = OMEKAS_SESSION

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; OPCACHE - ACELERACIÓN DE CÓDIGO (CRÍTICO PARA PRODUCCIÓN)
; Sistema de caché de bytecode que mejora rendimiento 3-5x
; Ver documentación detallada en respuesta anterior sobre OPcache
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; opcache.enable
; Activa el sistema de caché de bytecode
; Valor por defecto: 1 (en la mayoría de instalaciones modernas)
; Por qué asegurar que está activado: Es la optimización MÁS IMPORTANTE de PHP
; Impacto: Mejora rendimiento 300-500%, reduce uso de CPU 70-80%
opcache.enable = 1

; opcache.enable_cli
; Activa OPcache también para scripts CLI (línea de comandos)
; Valor por defecto: 0
; Por qué activarlo: Omeka S tiene scripts CLI para mantenimiento e importación
; Impacto: Scripts CLI también se benefician de caché
opcache.enable_cli = 1

; opcache.memory_consumption
; Memoria RAM dedicada al almacenamiento de bytecode (en MB)
; Valor por defecto: 128
; Por qué 256: Omeka S + módulos + temas = ~2000-5000 archivos PHP
;              Cada archivo compilado ocupa 50-200KB en caché
; Cálculo: 5000 archivos × 100KB promedio = 500MB máximo
;          256MB es suficiente para la mayoría de instalaciones
; Impacto: Si es insuficiente, archivos viejos se eliminan de caché (peor rendimiento)
opcache.memory_consumption = 256

; opcache.interned_strings_buffer
; Memoria para almacenar strings duplicados (nombres de variables, funciones, etc.)
; Valor por defecto: 8
; Por qué 16: Aplicaciones grandes tienen miles de strings idénticos
;             Compartirlos ahorra memoria significativa
; Impacto: Reduce uso de memoria 10-15%, mejora rendimiento ligeramente
opcache.interned_strings_buffer = 16

; opcache.max_accelerated_files
; Número máximo de archivos PHP que pueden estar en caché simultáneamente
; Valor por defecto: 10000 (desde PHP 7.0)
; Por qué 10000: Omeka S base + 10 módulos + 5 temas ≈ 3000-5000 archivos
;                10000 da margen suficiente para crecimiento
; IMPORTANTE: Debe ser un número primo para mejor distribución de hash
;             Números primos cercanos a potencias de 2 son óptimos
; Impacto: Si es muy bajo, archivos se eliminan prematuramente de caché
opcache.max_accelerated_files = 10000

; opcache.validate_timestamps
; Controla si PHP verifica si los archivos han cambiado en disco
; Valores: 0 = nunca verificar, 1 = verificar cada revalidate_freq segundos
; Valor por defecto: 1
; Por qué 0 en PRODUCCIÓN: Máximo rendimiento, archivos no cambian frecuentemente
; CRÍTICO: Con 0, DEBES reiniciar PHP después de actualizar código
; Comando: docker restart omekas-site
; Impacto: Mejora 10-20% rendimiento, pero cambios de código no se reflejan
;          hasta reiniciar PHP-FPM
opcache.validate_timestamps = 0

; opcache.revalidate_freq
; Frecuencia (en segundos) para verificar cambios si validate_timestamps = 1
; Valor por defecto: 2
; Por qué no aplica: Irrelevante cuando validate_timestamps = 0
; Impacto: N/A en esta configuración
; opcache.revalidate_freq = 60

; opcache.save_comments
; Guarda comentarios de código (docblocks) en la caché
; Valor por defecto: 1
; Por qué SIEMPRE 1: Frameworks modernos (incluido Laminas/Zend usado por Omeka)
;                    usan anotaciones en docblocks para routing, validación, etc.
; CRÍTICO: Con 0, Omeka S se ROMPE completamente
; Impacto: Usa ~5% más memoria, pero es OBLIGATORIO para funcionamiento
opcache.save_comments = 1

; opcache.fast_shutdown
; Usa método rápido de liberación de memoria al terminar
; Valor por defecto: 1 (desde PHP 7.2)
; Cómo funciona: Deja que el OS limpie la memoria en lugar de PHP
; Por qué mantenerlo: Reduce 20-30% el tiempo de shutdown
; Impacto: Respuestas ligeramente más rápidas, especialmente en scripts pesados
opcache.fast_shutdown = 1

; opcache.max_file_size
; Tamaño máximo (en bytes) de archivos PHP que se cachean (0 = sin límite)
; Valor por defecto: 0
; Por qué 0: Archivos muy grandes (vendor libs, clases generadas) también
;            deben cachearse para máximo rendimiento
; Impacto: Todos los archivos se cachean sin importar tamaño
opcache.max_file_size = 0

; opcache.consistency_checks
; Verifica integridad de caché cada N peticiones (0 = nunca)
; Valor por defecto: 0
; Por qué 0: Las verificaciones consumen CPU innecesariamente
;            Corrupción de caché es extremadamente rara en sistemas estables
; Impacto: Ahorra ciclos de CPU, riesgo mínimo de corrupción no detectada
opcache.consistency_checks = 0

; opcache.force_restart_timeout
; Tiempo (segundos) para esperar antes de reiniciar caché si está en uso
; Valor por defecto: 180
; Por qué mantenerlo: Previene reinicios durante picos de tráfico
; Impacto: Estabilidad durante alta carga
opcache.force_restart_timeout = 180

; opcache.huge_code_pages
; Usa huge pages de memoria si están disponibles en el sistema
; Valor por defecto: 0
; Por qué activar: Reduce overhead de TLB (Translation Lookaside Buffer)
;                  en sistemas con huge pages habilitados
; NOTA: Requiere configuración del SO (transparenthugepage=always)
; Impacto: Mejora 5-10% rendimiento SI el OS soporta huge pages
opcache.huge_code_pages = 1

; opcache.file_cache
; Ruta para caché de respaldo en disco (caché de segundo nivel)
; Valor por defecto: "" (desactivado)
; Por qué activarlo: Si PHP se reinicia, la caché en RAM se pierde
;                    La caché en disco permite recuperación más rápida
; Impacto: Primer request después de reinicio es 2x más rápido
opcache.file_cache = /tmp/opcache

; opcache.file_cache_only
; Usar SOLO caché en disco (sin caché en RAM)
; Valor por defecto: 0
; Por qué 0: La caché en RAM es mucho más rápida (10-100x)
;            La caché en disco es solo respaldo
; Impacto: Con 1, el rendimiento sería mucho peor
opcache.file_cache_only = 0

; opcache.file_cache_consistency_checks
; Verificar consistencia entre caché en disco y archivos fuente
; Valor por defecto: 1
; Por qué 0: Con validate_timestamps=0, las verificaciones son innecesarias
; Impacto: Pequeña mejora de rendimiento
opcache.file_cache_consistency_checks = 0

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; REALPATH CACHE - OPTIMIZACIÓN DE SISTEMA DE ARCHIVOS
; Caché de rutas absolutas de archivos para reducir llamadas al sistema
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; realpath_cache_size
; Tamaño del caché de rutas reales del sistema de archivos
; Valor por defecto: 4M (4096K)
; Por qué aumentarlo: Cada archivo require(), include(), etc. genera una llamada
;                     Aplicaciones grandes hacen miles de estas llamadas
; Impacto: Reduce llamadas al sistema de archivos, mejora 5-10% rendimiento
realpath_cache_size = 8M

; realpath_cache_ttl
; Tiempo (en segundos) que las rutas se mantienen en caché
; Valor por defecto: 120 (2 minutos)
; Por qué aumentarlo: En producción los archivos no se mueven/renombran
;                     Caché más larga = menos verificaciones
; Impacto: Menos overhead de sistema de archivos
realpath_cache_ttl = 600

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; DATE/TIME - ZONA HORARIA
; Configuración de zona horaria por defecto para funciones de fecha/hora
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; date.timezone
; Zona horaria por defecto para todas las funciones de fecha
; Valor por defecto: depende del sistema
; Por qué especificarlo: Evita warnings y asegura consistencia
; IMPORTANTE: Cambiar según la ubicación del proyecto
; Lista completa: https://www.php.net/manual/es/timezones.php
; Impacto: Todas las fechas usan esta zona horaria si no se especifica otra
date.timezone = America/Mexico_City

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; INTL - INTERNACIONALIZACIÓN
; Configuraciones para manejo de caracteres multibyte y locales
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; intl.default_locale
; Locale por defecto para funciones de internacionalización
; Valor por defecto: vacío (usa configuración del sistema)
; Por qué especificarlo: Consistencia en formato de fechas, números, ordenamiento
; Impacto: Funciones intl_* usan este locale por defecto
intl.default_locale = es_MX

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; FIN DE CONFIGURACIÓN
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;